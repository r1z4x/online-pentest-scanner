<?php if ($showLabel && $showField): ?>
    <?php if ($options['wrapper'] !== false): ?>
    <div <?= $options['wrapperAttrs'] ?> >
    <?php endif; ?>
<?php endif; ?>

<?php if ($showLabel && $options['label'] !== false): ?>
    <?= Form::label($name, $options['label'], $options['label_attr']) ?>
<?php endif; ?>

<?php if ($showField): ?>

	<?php if(isset($options['enabledFieldArea']) && $options['enabledFieldArea'] !== false): ?>
		<div class="<?= $options['areaFieldClass'] ?>" >
	<?php endif; ?>

	<div class="input-group">
    	<?= Form::input('text', $name . '[0][variable]', '', $options['attr']) ?>
    	<span class="input-group-addon" style="border-left: 0; border-right: 0;"><span class="fa fa-arrows-h"></span></span>
    	<?= Form::input('text', $name . '[0][value]', '', $options['attr']) ?>

    	<span class="input-group-btn">
        	<button id="dynamic_add_btn" class="btn <?= isset($options['buttonClass']) ? $options['buttonClass'] : 'btn-default' ?>" type="button"><span class="fa fa-plus"></span></button>
      	</span>
    </div>

	<?php if(!old($name) && isset($options['value']) && count($options['value'])): ?>
		<?php foreach($options['value'] as $key => $input): $key++; 

			if( !isset($input->variable) || !isset($input->value) )
				continue;
		?>

		<div class="input-group" style="margin-top:10px">
	    	<?= Form::input('text', $name . '['.$key.'][variable]', $input->variable, $options['attr']) ?>
	    	<span class="input-group-addon" style="border-left: 0; border-right: 0;"><span class="fa fa-arrows-h"></span></span>
	    	<?= Form::input('text', $name . '['.$key.'][value]', $input->value, $options['attr']) ?>

	    	<span class="input-group-btn">
	        	<button class="btn btn-danger dynamic_del_btn" type="button"><span class="fa fa-times"></span></button>
	      	</span>
	    </div>

		<?php endforeach; ?>
	<?php endif; ?>

    <?php if (old($name)): ?>

	    <?php foreach(old($name) as $key => $input):

	    	if( !isset($input['variable']) || !isset($input['value']) ||  $input['variable'] === '' || $input['value'] === '')
				continue;
	    ?>

	    <div class="input-group" style="margin-top:10px">
	    	<?= Form::input('text', $name . '['.$key.'][variable]', $input['variable'], $options['attr']) ?>
	    	<span class="input-group-addon" style="border-left: 0; border-right: 0;"><span class="fa fa-arrows-h"></span></span>
	    	<?= Form::input('text', $name . '['.$key.'][value]', $input['value'], $options['attr']) ?>

	    	<span class="input-group-btn">
	        	<button class="btn btn-danger dynamic_del_btn" type="button"><span class="fa fa-times"></span></button>
	      	</span>
	    </div>

	    <?php endforeach; ?>
	<?php endif; ?>

    <?php include 'help_block.php' ?>

    <?php if(isset($options['enabledFieldArea']) && $options['enabledFieldArea'] !== false): ?>
    	</div>
	<?php endif; ?>
<?php endif; ?>

<?php if ($showLabel && $showField): ?>
    <?php if ($options['wrapper'] !== false): ?>
    </div>
    <?php endif; ?>
<?php endif; ?>

<script type="text/javascript">
	$('#dynamic_add_btn').on('click', function(e){
		e.preventDefault();
		var _tmp = $(this).parents('.input-group').clone().css('margin-top', '10px');
		$('.input-group-btn button', _tmp).removeAttr('id')
			.addClass('dynamic_del_btn')
			.removeClass (function (index, css) {
			    return (css.match (/(^|\s)btn-\S+/g) || []).join(' ');
			})
			.addClass('btn-danger');

		var _count = Number($(this).parents('.input-group').parent().find('.input-group').length);
		
		$('input[type=text]', _tmp).each(function(){
			$(this).attr('name', $(this).attr('name').replace( /[\d+]/g, _count));
			$(this).val('');
		});

		$('.input-group-btn button span.fa', _tmp).removeClass('fa-plus').addClass('fa-times');
		$(this).parents('.input-group').after(_tmp);
	});

	$(document).on('click', '.dynamic_del_btn', function(e){
		e.preventDefault();
		$(this).parents('.input-group').remove();
	});
</script>
