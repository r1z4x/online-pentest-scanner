@extends('layouts.master')

@section('title')
    {{ trans('pages.scans.title') }}
@endsection

@section('container')

	<div class="media">
        <div class="media-body media-middle">
          <h1 class="page-heading h2">{{ trans('pages.scans.title') }}</h1>
        </div>
        <div class="media-right media-middle">
         	<a href="{{ route('pages.scans.create') }}" class="btn btn-success btn-rounded {{ ($scans->count() >= (int)config('custom.limits.free.new_user_max_create_scans_count')) ? 'disabled' : '' }}"><i class="material-icons">add_circle_outline</i> {{ trans('pages.scans_create.title') }}</a>
        </div>
    </div>

    @include('errors.validation')

	<div class="card-columns">

        @forelse($scans as $scan)

	    <div class="card {{ ( session()->has('messages.scan_id') && $scan->id == session()->get('messages.scan_id') ) ? 'card-success' : '' }}">
	        <div class="card-button-wrapper">
	            <a href="#" class="btn btn-primary btn-sm scanPlayBtn {{ ($scan->is_lock) ? 'disabled' : '' }}" data-id="{{ $scan->id }}"><i class="material-icons">play_circle_outline</i> </a>
	            <a href="#" class="btn btn-white btn-sm scanStopBtn {{ (!$scan->is_lock) ? 'disabled' : '' }}" data-id="{{ $scan->id }}"><i class="material-icons">pause_circle_outline</i> </a>
	            <a href="#" class="btn btn-white btn-sm scanRepeatBtn {{ (!$scan->is_lock) ? 'disabled' : '' }}" data-id="{{ $scan->id }}"><i class="material-icons">replay</i> </a>
	            <a href="#" class="btn btn-danger btn-sm scanRemoveBtn {{ ($scan->is_lock) ? 'disabled' : '' }}" data-id="{{ $scan->id }}"><i class="material-icons">remove_circle_outline</i> </a>
	        </div>
	        <div class="card-header bg-white ">
	            <h4 class="card-title"><a href="{{ route('pages.scans.show', $scan->id) }}">{{ $scan->name }}</a></h4>
	            <small class="text-muted">{{ $scan->profile->name }}</small>
	        </div>
	        <progress class="progress progress-success progress-striped m-b-0" value="100" max="100">56%</progress>
	        <div class="card-footer bg-white">
                <ul class="list-group list-group-fit m-b-0">
                    @foreach($scan->urls as $url)
                    <li class="list-group-item">
                        <div class="media">
                            <div class="media-left">
                                <i class="material-icons text-muted-light">link</i>
                            </div>
                            <div class="media-body media-middle {{ !$url['token-check'] ? 'text-danger' : '' }}" {!! !$url['token-check'] ? 'data-toggle="tooltip" data-title="'.trans('pages.scans_create.forms.unverified').'"' : '' !!}>
                                {{ $url['url'] }}
                            </div>
                        </div>
                    </li>
                    @endforeach
                    <?php /* ?>
                    @foreach($scan->urls as $url)
                    <li class="list-group-item">
                        <div class="media">
                            <div class="media-left">
                                <i class="material-icons text-muted-light">link</i>
                            </div>
                            <div class="media-body media-middle">
                                {{ $url['url'] }}
                            </div>
                        </div>
                    </li>
                    @endforeach
                    <?php */ ?>
                </ul>
	        </div>
	    </div>

        @empty

        @endforelse

        <nav>
            {!! $scans->render() !!}
        </nav>
	</div>


@endsection

@section('scripts')
    <script type="text/javascript">
        $(function(){
            $('[data-toggle="tooltip"]').tooltip();

            $('a.scanRemoveBtn').on('click', function(event){
                event.preventDefault();
                var _id = $(this).data('id');

                if(!(_id > 0))
                    return false;

                alert(_id);
            });

            $('a.scanPlayBtn').on('click', function(event){
                event.preventDefault();
                var _id = $(this).data('id');

                if(!(_id > 0))
                    return false;

                alert(_id);
            });

            $('a.scanStopBtn').on('click', function(event){
                event.preventDefault();
                var _id = $(this).data('id');

                if(!(_id > 0))
                    return false;

                alert(_id);
            });

            $('a.scanRepeatBtn').on('click', function(event){
                event.preventDefault();
                var _id = $(this).data('id');

                if(!(_id > 0))
                    return false;

                alert(_id);
            });
        });
    </script>
@endsection
