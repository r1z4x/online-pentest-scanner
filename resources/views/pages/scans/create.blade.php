@extends('layouts.master')

@section('title')
    {{ trans('pages.scans_create.title') }}
@endsection

@section('styles')
    <link rel="stylesheet" href="{{ asset('assets/css/sweetalert.min.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/bootstrap-datepicker.min.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/bootstrap-timepicker.min.css') }}">
@endsection

@section('container')

    @include('errors.validation')

    <div class="card">
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link {{ ($type == 'general-information') ? 'active' : '' }}" href="#general-information"><i class="material-icons">info_outline</i> {{ trans('pages.scans_create.general_information') }}</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {{ ($type == 'scan-settings') ? 'active' : '' }}" href="#scan-settings"><i class="material-icons">settings</i> {{ trans('pages.scans_create.scan_settings') }}</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {{ ($type == 'schedule-settings') ? 'active' : '' }}" href="#schedule-settings"><i class="material-icons">schedule</i> {{ trans('pages.scans_create.schedule_settings') }}</a>
            </li>
            <li class="nav-item">
                <a class="nav-link {{ ($type == 'completed') ? 'active' : '' }}" href="#scan-completed"><i class="material-icons">done</i> {{ trans('pages.scans_create.scan_completed') }}</a>
            </li>
        </ul>
        <div class="card-header">
            <h4 class="card-title">

                @if($type == 'general-information')

                {{ trans('pages.scans_create.general_information') }}

                @elseif($type == 'scan-settings')

                {{ trans('pages.scans_create.scan_settings') }} - <small><i>{{ session()->get('scans_create.name') }}</i></small>

                @elseif($type == 'scan-settings')

                {{ trans('pages.scans_create.schedule_settings') }} - <small><i>{{ session()->get('scans_create.name') }}</i></small>

                @elseif($type == 'completed')

                {{ trans('pages.scans_create.scan_completed') }}

                @endif
            </h4>
        </div>
        <form action="{{ route('pages.scans.create', $type) }}" method="POST" autocomplete="off">
            <input type="hidden" name="_token" value="{{ csrf_token() }}">
            <div class="p-a-1">

                @if($type == 'general-information')

                <div class="form-group row {{ $errors->has('name') ? 'has-danger' : '' }}">
                    <label for="scan_name" class="col-sm-3 form-control-label">{{ trans('pages.scans.forms.name') }} :</label>
                    <div class="col-sm-9 col-md-4">
                        <div class="input-group">
                            <span class="input-group-addon" id="sizing-addon2">#</span>
                            <input id="scan_name" name="name" type="text" class="form-control {{ $errors->has('name') ? 'form-control-danger' : '' }}" placeholder="{{ trans('pages.scans.forms.name') }}" aria-describedby="sizing-addon2" value="{{ old('name') }}">
                        </div>
                    </div>
                </div>
                <div class="form-group row {{ $errors->has('profile') ? 'has-danger' : '' }}">
                    <label for="scan_profile" class="col-sm-3 form-control-label">{{ trans('pages.scans.forms.profile') }} :</label>
                    <div class="col-sm-9 col-md-4">
                        <select id="scan_profile" name="profile" class="c-select form-control {{ $errors->has('profile') ? 'form-control-danger' : '' }}" placeholder="{{ trans('pages.scans.forms.profile') }}">
                            @foreach($profiles as $profile)
                                <option value="{{ $profile->id }}" {{ $profile->is_default == true ? 'selected' : '' }}>{{ $profile->name }}</option>
                            @endforeach
                        </select>
                    </div>
                </div>
                <div class="form-group row {{ $errors->has('active') ? 'has-danger' : '' }}">
                    <label for="scan_active" class="col-sm-3 form-control-label">{{ trans('pages.scans.forms.active') }} :</label>
                    <div class="col-sm-9">
                        <div class="switch">
                            <input name="active" id="scan_active" class="switch-toggle switch-toggle-round {{ $errors->has('active') ? 'form-control-danger' : '' }}" type="checkbox" checked>
                            <label for="scan_active"></label>
                        </div>
                    </div>
                </div>
                <div class="form-group row {{ $errors->has('description') ? 'has-danger' : '' }}">
                    <label for="scan_description" class="col-sm-3 form-control-label">{{ trans('pages.scans.forms.description') }} :</label>
                    <div class="col-sm-9 col-md-6">
                        <textarea id="scan_description" name="description" class="form-control {{ $errors->has('description') ? 'form-control-danger' : '' }}" rows="4" placeholder="{{ trans('pages.scans.forms.description') }}"></textarea>
                    </div>
                </div>

                @elseif($type == 'scan-settings')

                <div class="card m-t-2">
                    <div class="card-header bg-white">
                        <div class="media">
                            <div class="media-left media-middle">
                                <i class="material-icons">link</i>
                            </div>
                            <div class="media-body media-middle">
                                <h4 class="card-title">{{ trans('pages.scans_create.url_lists') }}</h4>
                            </div>
                            <div class="media-right media-middle">
                                <a href="#" data-toggle="modal" data-target="#modalScanSetting" class="btn btn-primary btn-rounded"><i class="material-icons">add_circle_outline</i></a>
                            </div>
                        </div>
                    </div>
                    <div class="card-block">
                      <ul id="modalURLListsBox" class="list-group list-group-fit nestable-list-plain m-b-0">
                            @forelse($tmp_url_lists as $index => $list)
                            <li class="list-group-item nestable-item">
                                <div class="media">
                                    <input type="hidden" name="url_lists[{{ $index }}]" value="{{ (isset($list) && count($list)) ? json_encode($list) : '' }}"></input>
                                    <div class="media-left media-middle">
                                        @if(isset($list['token-check']) && $list['token-check'] == true)
                                        <i class="material-icons text-success">check</i>
                                        @else
                                        <i class="material-icons text-danger">close</i>
                                        @endif
                                    </div>
                                    <div class="media-body media-middle">
                                        <span>{{ $list['url'] }}</span>&nbsp;&nbsp;<small><i>{{ trans('pages.scans_create.forms.checking_date') }}: {{ isset($list['token-check-date']) ? $list['token-check-date'] : 'none' }}</i></small>
                                    </div>
                                    <div class="media-right right media-middle">
                                        <div style="width:300px;">
                                            <a href="#" data-index="{{ $index }}" class="btn btn-primary btn-sm scanUrlInfo"><i class="material-icons">info_outline</i> {{ trans('pages.scans_create.forms.info_button') }}</a>
                                            <a href="#" data-index="{{ $index }}" class="btn btn-success btn-sm scanSyncCheck {{ (isset($list['token-check']) && $list['token-check'] == true) ? 'disabled' : '' }}"><i class="material-icons">sync</i> {{ trans('pages.scans_create.forms.check_button') }}</a>
                                            <a href="#" data-index="{{ $index }}" class="btn btn-danger btn-sm scanUrlRemove"><i class="material-icons">remove_circle_outline</i> {{ trans('pages.scans_create.forms.remove_button') }}</a>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            @empty
                            <li class="list-group-item nestable-item">
                                <p class="lead text-xs-center">
                                    <i class="material-icons text-warning" style="font-size:64px">highlight_off</i><br/>
                                    {{ trans('pages.scans_create.forms.not_found_lists') }}
                                </p>
                            </li>
                            @endforelse
                        </ul>
                    </div>
                </div>

                <div class="card m-t-2">
                    <div class="card-header bg-white">
                        <div class="media">
                            <div class="media-left media-middle">
                                <i class="material-icons">location_searching</i>
                            </div>
                            <div class="media-body media-middle">
                                <h4 class="card-title">{{ trans('pages.scans_create.asset_lists') }}</h4>
                            </div>
                            <div class="media-right media-middle">
                                <!-- <a href="#" data-toggle="modal" data-target="#modalScanSetting" class="btn btn-primary btn-rounded"><i class="material-icons">add_circle_outline</i></a> -->
                            </div>
                        </div>
                    </div>
                    <div class="card-block">

                        <div class="alert alert-danger alert-dismissible fade in" role="alert">
                            <strong>Comin soon!</strong> This feature will be activated very soon.
                        </div>

                    </div>
                </div>

                @elseif($type == 'schedule-settings')

                <div class="form-group row {{ $errors->has('repeat') ? 'has-danger' : '' }}">
                    <label for="scan_repeat" class="col-sm-3 form-control-label">{{ trans('pages.scans.forms.repeat') }} :</label>
                    <div class="col-sm-9 col-md-4">
                        <select id="scan_repeat" name="repeat" class="c-select form-control {{ $errors->has('repeat') ? 'form-control-danger' : '' }}" placeholder="{{ trans('pages.scans.forms.repeat') }}">
                            @foreach($repeats as $index => $repeat)
                                <option value="{{ $index }}" {{ old('repeat') == $index ? 'selected' : '' }}>{{ $repeat }}</option>
                            @endforeach
                        </select>
                    </div>
                </div>
                <div class="form-group row {{ ( $errors->has('starts_on_date') || $errors->has('starts_on_time') ) ? 'has-danger' : '' }}">
                    <label for="scan_starts_on" class="col-sm-3 form-control-label">{{ trans('pages.scans.forms.starts_on') }} :</label>
                    <div class="col-sm-3 col-md-2">
                        <input id="scan_starts_on" name="starts_on_date" type="text" class="datepicker form-control {{ $errors->has('starts_on_date') ? 'form-control-danger' : '' }}" placeholder="{{ trans('pages.scans.forms.starts_on') }}" value="{{ old('starts_on_date', \Carbon\Carbon::now()->toDateString()) }}">
                    </div>
                    <div class="col-sm-3 col-md-2">
                        <input id="scan_starts_on" name="starts_on_time" type="text" class="timepicker form-control {{ $errors->has('starts_on_time') ? 'form-control-danger' : '' }}" placeholder="{{ trans('pages.scans.forms.starts_on') }}" value="{{ old('starts_on_time', \Carbon\Carbon::now()->format('h:i A')) }}">
                    </div>
                    <div class="col-sm-3 col-md-2">
                        <select id="scan_starts_on" name="starts_on_utc" class="c-select form-control {{ $errors->has('starts_on_utc') ? 'form-control-danger' : '' }}" placeholder="{{ trans('pages.scans.forms.starts_on') }}">
                            @foreach($timezones as $timezone)
                                <option value="{{ $timezone }}" {{ old('starts_on_utc', 'UTC') == \Carbon\Carbon::now()->tzName ? 'selected' : '' }}>{{ $timezone }}</option>
                            @endforeach
                        </select>
                    </div>
                </div>
                <div class="form-group row {{ $errors->has('repeat_every') ? 'has-danger' : '' }}">
                    <label for="scan_repeat_every" class="col-sm-3 form-control-label">{{ trans('pages.scans.forms.repeat_every') }} :</label>
                    <div class="col-sm-9 col-md-4">
                        <input id="scan_repeat_every" data-toggle="touch-spin" data-min="0" data-max="30" data-step="1" name="repeat_every" type="text" class="form-control {{ $errors->has('repeat_every') ? 'form-control-danger' : '' }}" placeholder="{{ trans('pages.scans.forms.repeat_every') }}" value="{{ old('repeat_every', 0) }}">
                    </div>
                </div>

                @elseif($type == 'completed')

                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header bg-white">
                                <div class="media">
                                    <div class="media-left media-middle">
                                        <i class="material-icons">info_outline</i>
                                    </div>
                                    <div class="media-body media-middle">
                                        <h4 class="card-title"><small>{{ trans('pages.scans.forms.name') }},</small> {{ session()->get('scans_create.name') }}</h4>
                                    </div>
                                </div>
                            </div>
                            @if(session()->has('scans_create.description') && session()->get('scans_create.description'))
                            <div class="card-block">
                                {{ session()->get('scans_create.description') }}
                            </div>
                            @endif

                            <ul class="list-group list-group-fit">
                                <li class="list-group-item list-group-item-{{ (session()->has('scans_create.active') && session()->get('scans_create.active')) ? 'success' : 'danger' }}">
                                    <div class="media">
                                        <div class="media-left">
                                            <i class="material-icons">{{ (session()->has('scans_create.active') && session()->get('scans_create.active')) ? 'check_circle' : 'remove_circle' }}</i>
                                        </div>
                                        <div class="media-body media-middle">
                                            @if(session()->has('scans_create.active') && session()->get('scans_create.active'))
                                                {{ trans('pages.scans_create.forms.active') }}
                                            @else
                                                {{ trans('pages.scans_create.forms.passive') }}
                                            @endif
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    <div class="media">
                                        <div class="media-left">
                                            <i class="material-icons text-muted-light">gps_fixed</i>
                                        </div>
                                        <div class="media-body media-middle">
                                            {{ $profile_name }}
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        @if(session()->has('scans_create.repeat'))
                        <div class="card">
                            <div class="card-header bg-white">
                                <div class="media">
                                    <div class="media-left media-middle">
                                        <i class="material-icons">schedule</i>
                                    </div>
                                    <div class="media-body media-middle">
                                        <h4 class="card-title">{{ trans('pages.scans_create.forms.schedule') }}</h4>
                                    </div>
                                </div>
                            </div>
                            <ul class="list-group list-group-fit">
                                <li class="list-group-item">
                                    <div class="media">
                                        <div class="media-left">
                                            <i class="material-icons text-muted-light">update</i>
                                        </div>
                                        <div class="media-body media-middle">
                                            {{ session()->get('scans_create.starts_on_date') }} {{ session()->get('scans_create.starts_on_time') }} {{ session()->get('scans_create.starts_on_utc') }}
                                        </div>
                                    </div>
                                </li>
                                <li class="list-group-item">
                                    <div class="media">
                                        <div class="media-left">
                                            <i class="material-icons text-muted-light">repeat</i>
                                        </div>
                                        <div class="media-body media-middle">

                                            {{ \App\Models\Scan::$repeats[session()->get('scans_create.repeat')] }}

                                            @if(session()->has('scans_create.repeat_every') && session()->get('scans_create.repeat_every') > 0)
                                                session()->get('scans_create.repeat_every')
                                            @else
                                                <i class="material-icons text-primary" data-toggle="tooltip" data-placement="bottom" title="{{ trans('pages.scans_create.forms.autorenew_info') }}">autorenew</i>
                                            @endif
                                        </div>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        @endif
                    </div>
                    <div class="col-md-8">

                        <div class="card">
                            <div class="card-header bg-white">
                                <div class="media">
                                    <div class="media-left media-middle">
                                        <i class="material-icons">link</i>
                                    </div>
                                    <div class="media-body media-middle">
                                        <h4 class="card-title">{{ trans('pages.scans_create.url_lists') }}</h4>
                                    </div>
                                </div>
                            </div>
                            <div class="card-block">
                              <ul class="list-group list-group-fit nestable-list-plain m-b-0">
                                    @forelse($url_lists as $index => $list)
                                    <li class="list-group-item nestable-item">
                                        <div class="media">
                                            <div class="media-left media-middle">
                                                @if(isset($list['token-check']) && $list['token-check'] == true)
                                                <i class="material-icons text-success">check</i>
                                                @else
                                                <i class="material-icons text-danger">close</i>
                                                @endif
                                            </div>
                                            <div class="media-body media-middle">
                                                <span>{{ $list['url'] }}</span>&nbsp;&nbsp;<small><i>{{ trans('pages.scans_create.forms.checking_date') }}: {{ isset($list['token-check-date']) ? $list['token-check-date'] : 'none' }}</i></small>
                                            </div>
                                            <div class="media-right right media-middle"></div>
                                        </div>
                                    </li>
                                    @empty
                                    <li class="list-group-item nestable-item">
                                        <p class="lead text-xs-center">
                                            <i class="material-icons text-warning" style="font-size:64px">highlight_off</i><br/>
                                            {{ trans('pages.scans_create.forms.not_found_lists') }}
                                        </p>
                                    </li>
                                    @endforelse
                                </ul>
                            </div>
                        </div>

                    </div>
                </div>


                @endif
            </div>
            <div class="card-footer clearfix">

                @if($type == 'schedule-settings')
                <a id="skipBtn" href="#" class="btn btn-white">{{ trans('pages.scans.forms.skip_button') }} <i class="material-icons">skip_next</i></a>
                @endif

                @if($type == 'completed')
                <button type="submit" class="btn btn-success btn-rounded pull-xs-right"><i class="material-icons">done_all</i> {{ trans('pages.scans.forms.complete_button') }}</button>
                @else
                <button type="submit" class="btn btn-success btn-rounded pull-xs-right">{{ trans('pages.scans.forms.next_button') }}<i class="material-icons">navigate_next</i></button>
                @endif
            </div>
        </form>
    </div>

    @if($type == 'scan-settings')
    <div class="modal fade" id="modalScanSetting">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h5 class="modal-title js-title-step"></h5>
                </div>
                <div class="modal-body">
                    <form action="#" autocomplete="off">
                        <div class="hide" data-step="1" data-title="{{ trans('pages.scans_create.url_checking') }}">
                            <div class="form-group row">
                                <label for="scan_url" class="col-sm-2 form-control-label">{{ trans('pages.scans_create.forms.url') }}</label>
                                <div class="col-sm-10 col-md-10">
                                    <div class="input-group">
                                        <span class="input-group-addon" id="basic-addon2">
                                            <i class="material-icons md-18 text-muted">language</i>
                                        </span>
                                        <input id="scan_url" name="scan_url" class="form-control" placeholder="http://" value="" type="text">
                                    </div>
                                    <small class="text-help">{{ trans('pages.scans_create.forms.url_description') }}</small>
                                </div>
                            </div>
                        </div>
                        <div class="hide" data-step="2" data-title="{{ trans('pages.scans_create.url_verification') }}">
                            <div class="card-block">
                                {!! trans('pages.scans_create.forms.url_extra_description') !!}
                            </div>

                            <div id="modalScanUrlInfo"></div>
                        </div>
                        <div id="modalScanResultsBox"></div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default btn-rounded js-btn-step pull-xs-left" data-orientation="cancel" data-dismiss="modal"></button>
                    <button type="button" class="btn btn-warning btn-rounded js-btn-step" data-orientation="previous"></button>
                    <button type="button" class="btn btn-success btn-rounded js-btn-step" data-orientation="next"></button>
                </div>
            </div>
        </div>
    </div>

    @endif

@endsection

@section('scripts')
    <script type="text/javascript" src="{{ asset('assets/vendor/sweetalert.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('assets/vendor/bootstrap-datepicker.min.js') }}"></script>
    <script type="text/javascript" src="{{ asset('assets/vendor/bootstrap-timepicker.js') }}"></script>
    <script type="text/javascript" src="{{ asset('assets/vendor/jquery.bootstrap-touchspin.js') }}"></script>

    <script type="text/javascript">
        $(function(){

            $('.datepicker').plusDatePicker({
                format: 'yyyy-mm-dd'
            });

        	$('.timepicker').plusTimePicker({
        		minuteStep: 5,
        		showInputs: false,
        		disableFocus: true
        	});

            $('form a#skipBtn').on('click', function(event){
                event.preventDefault();
                $(this).before('<input type="hidden" name="_skip" value="1">');
                $(this).parents('form').submit();
            });

            $('[data-toggle="touch-spin"]').APTouchSpin();
            $('[data-toggle="tooltip"]').tooltip()

            var _ALERT_TEMPLATE = '<div class="alert alert-{T} alert-dismissible fade in" role="alert"><strong>{H}</strong> {M}</div>';

            var _URL_INFO_TEMPLATE = '<div class="card card-stats-warning"><div class="card-block"><div class="media"><div class="media-left media-middle"><i class="material-icons">link</i></div><div class="media-body media-middle">{U}</div></div><div class="media"><div class="media-left media-middle"><i class="material-icons">insert_drive_file</i></div><div class="media-body media-middle">{F}</div></div><div class="media"><div class="media-left media-middle"><i class="material-icons">code</i></div><div class="media-body media-middle">{C}</div></div></div></div>';

            var _URL_LIST_TEMPLATE = `

                <li class="list-group-item nestable-item">
                    <div class="media">
                        <input type="hidden" name="url_lists[{C}]" value="{JDATA}"></input>
                        <div class="media-left media-middle">
                            {T}
                        </div>
                        <div class="media-body media-middle">
                            <span>{U}</span>&nbsp;&nbsp;<small><i>{{ trans('pages.scans_create.forms.checking_date') }}: {D}</i></small>
                        </div>
                        <div class="media-right right media-middle">
                            <div style="width:300px;">
                                <a href="#" data-index="{C}" class="btn btn-primary btn-sm scanUrlInfo"><i class="material-icons">info_outline</i> {{ trans('pages.scans_create.forms.info_button') }}</a>
                                <a href="#" data-index="{C}" class="btn btn-success btn-sm scanSyncCheck {CDISABLED}"><i class="material-icons">sync</i> {{ trans('pages.scans_create.forms.check_button') }}</a>
                                <a href="#" data-index="{C}" class="btn btn-danger btn-sm scanUrlRemove"><i class="material-icons">remove_circle_outline</i> {{ trans('pages.scans_create.forms.remove_button') }}</a>
                            </div>
                        </div>
                    </div>
                </li>

            `;

            var _LIST_LIMIT = '{{ (int)config('custom.limits.free.new_user_max_create_scans_count') }}'

            var _URL_LIST_EMPTY_TEMPLATE = '<li class="list-group-item nestable-item"><p class="lead text-xs-center"><i class="material-icons text-warning" style="font-size:64px">highlight_off</i><br/>{{ trans('pages.scans_create.forms.not_found_lists') }}</p></li>';

            var _CURRENT_DATA = {};

            $('body').on('click', '.scanUrlInfo', function () {

                var _index = $(this).data('index');
                var _data  = $('input[name="url_lists['+_index+']"]').val();

                if( _index >= 0 && _data && (__data = JSON.parse(_data)) && Object.keys(__data).length > 0){

                    swal({
                        title: __data.url,
                        text: _URL_INFO_TEMPLATE.replaceAll('{C}', __data['content-token'])
                            .replaceAll('{F}', __data['file-token'])
                            .replaceAll('{U}', __data['url']),
                        html: true,
                        confirmButtonColor: "#039BE5"
                    });

                }else{

                    swal({
                        title: "Oops!",
                        text: "{{ trans('pages.scans_create.forms.system_error') }}",
                        type: "error",
                        showCancelButton: true,
                        confirmButtonColor: "#F44336",
                        cancelButtonText: "{{ trans('pages.scans.forms.delete_cancel_button') }}"
                    });
                }

            });

            $('body').on('click', '.scanSyncCheck', function () {

                var _index = $(this).data('index');
                var _parent = $(this).parents('.list-group-item');
                var _data  = $('input[name="url_lists['+_index+']"]').val();

                if( _index >= 0 && _data && (__data = JSON.parse(_data)) && Object.keys(__data).length > 0){

                  $.ajax({
                      url     : '{{ route('api.scans.check_url') }}',
                      data    : { _url : __data['url'], _token    : $('meta[name=csrf-token]').attr('content') },
                      method  : 'POST',
                      success : function(response){

                          if(response && response.status == true && response.results && response.results.url){

                              if( !$('.scanSyncCheck', _parent).hasClass('disabled') )
                                  $('.scanSyncCheck', _parent).addClass('disabled');

                              $('.media-left > i', _parent)
                                  .removeClass('text-' + ( ! (response.results['token-check'] && response.results['token-check'] == true ) ) ? 'success' : 'danger')
                                  .addClass('text-' + ( response.results['token-check'] && response.results['token-check'] == true ) ? 'success' : 'danger');

                              $('.media-left > i', _parent).text(( response.results['token-check'] && response.results['token-check'] == true ) ? 'check' : 'close');
                              $('.media-body > small > i', _parent).text('{{ trans('pages.scans_create.forms.checking_date') }}: ' + response.results['token-check-date']);

                          }else{

                              swal({
                                  title: "Oops!",
                                  text: "{{ trans('pages.scans_create.forms.checking_error') }}",
                                  type: "error",
                                  showCancelButton: false,
                                  confirmButtonColor: "#F44336"
                              });

                          }

                      }
                  });

                }
            });

            $('body').on('click', '.scanUrlRemove', function () {

                var _index = $(this).data('index');
                var _parent = $(this).parents('.list-group-item');
                var _data  = $('input[name="url_lists['+_index+']"]').val();

                if( _index >= 0 && _data && (__data = JSON.parse(_data)) && Object.keys(__data).length > 0){

                    $(_parent).addClass('list-group-item-warning');

                    swal({
                        title: "{{ trans('pages.scans.forms.delete_title') }}",
                        text: "{{ trans('pages.scans.forms.delete_confirm') }}",
                        type: "error",
                        showCancelButton: true,
                        confirmButtonColor: "#F44336",
                        confirmButtonText: "{{ trans('pages.scans.forms.delete_confirm_button') }}",
                        cancelButtonText: "{{ trans('pages.scans.forms.delete_cancel_button') }}",
                        closeOnConfirm: true,
                        closeOnCancel: true
                    },
                    function(isConfirm){

                        if(isConfirm)
                        {
                            $.ajax({
                                url     : '{{ route('api.scans.remove_url') }}',
                                data    : { _url : __data['url'], _token    : $('meta[name=csrf-token]').attr('content') },
                                method  : 'POST',
                                success : function(response){

                                    if(response && response.status == true){

                                        if($('li.list-group-item', $(_parent).parents('.list-group')).length <= 1)
                                            $(_parent).parents('.list-group').html(_URL_LIST_EMPTY_TEMPLATE);

                                        $(_parent).remove();

                                        if( $('ul#modalURLListsBox li.list-group-item').length >= _LIST_LIMIT )
                                            $('a[data-target="#modalScanSetting"]').prop('disabled', true);
                                        else
                                            $('a[data-target="#modalScanSetting"]').prop('disabled', false);

                                    }else{

                                        swal({
                                            title: "Oops!",
                                            text: "{{ trans('pages.scans_create.forms.removing_error') }}",
                                            type: "error",
                                            showCancelButton: true,
                                            confirmButtonColor: "#F44336",
                                            cancelButtonText: "{{ trans('pages.scans.forms.delete_cancel_button') }}"
                                        });

                                    }
                                },
                                error   : function(response){

                                    if(response && response.responseJSON && response.responseJSON.status == false){

                                        swal({
                                            title: "Oops!",
                                            text: "{{ trans('pages.scans_create.forms.system_error') }}",
                                            type: "error",
                                            showCancelButton: true,
                                            confirmButtonColor: "#F44336",
                                            cancelButtonText: "{{ trans('pages.scans.forms.delete_cancel_button') }}"
                                        });

                                    }
                                }
                            });
                        }

                        $(_parent).removeClass('list-group-item-warning');
                    });

                }else{

                    swal({
                        title: "Oops!",
                        text: "{{ trans('pages.scans_create.forms.system_error') }}",
                        type: "error",
                        showCancelButton: true,
                        confirmButtonColor: "#F44336",
                        cancelButtonText: "{{ trans('pages.scans.forms.delete_cancel_button') }}"
                    });
                }

            });

            $('button.js-btn-step[data-orientation=next]').prop('disabled', false);

            $('#modalScanSetting').modalSteps({
                btnCancelHtml: '<i class="material-icons">close</i> {{ trans('pages.scans.forms.cancel_button') }}',
                btnPreviousHtml: '<i class="material-icons">navigate_before</i> {{ trans('pages.scans.forms.prev_button') }}',
                btnNextHtml: '{{ trans('pages.scans.forms.next_button') }} <i class="material-icons">navigate_next</i>',
                btnLastStepHtml: '<i class="material-icons">done_all</i> {{ trans('pages.scans.forms.complete_button') }}',
                completeCallback: function(){

                    var _status = true;

                    $('#modalScanResultsBox').html('');

                    var _url = $('input#scan_url').val();

                    if(!/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test( _url ))
                    {
                        $('#modalScanResultsBox').html(
                                _ALERT_TEMPLATE.replaceAll('{T}', 'danger')
                                    .replaceAll('{M}', '{{ trans('pages.scans_create.forms.url_error') }}')
                                    .replaceAll('{H}', 'Oops!')
                            );

                        $('input#scan_url').focus();

                        _status = false;

                    }else{

                        _status = true;

                        if( $('ul#modalURLListsBox li.list-group-item .media-body span:contains("'+_url+'")').length == 0 )

                            if(!($('ul#modalURLListsBox li.list-group-item').length >= _LIST_LIMIT)){

                                if($('ul#modalURLListsBox li.list-group-item p.lead').length > 0)
                                    $('ul#modalURLListsBox li.list-group-item').remove();

                                $('ul#modalURLListsBox').append(
                                    _URL_LIST_TEMPLATE.replaceAll('{C}', ('ul#modalURLListsBox li.list-group-item').length)
                                        .replaceAll('{U}', _url)
                                        .replaceAll('{D}', 'none')
                                        .replaceAll('{JDATA}', JSON.stringify(_CURRENT_DATA).replaceAll('"', '&quot;'))
                                        .replaceAll('{CDISABLED}', '')
                                        .replaceAll('{T}', '<i class="material-icons text-danger">close</i>')
                                );

                            }else
                                swal({
                                    title: "Oops!",
                                    text: "{{ trans('pages.scans_create.forms.limit_error') }}",
                                    type: "error",
                                    showCancelButton: false,
                                    confirmButtonColor: "#F44336"
                                });

                            if( $('ul#modalURLListsBox li.list-group-item').length >= _LIST_LIMIT )
                                $('a[data-target="#modalScanSetting"]').prop('disabled', true);
                            else
                                $('a[data-target="#modalScanSetting"]').prop('disabled', false);
                    }

                    return _status;
                },
                callbacks : {
                    '*' : function(step){

                        var _status = true;

                        $('#modalScanResultsBox').html('');

                        if(step == 1){

                            var _url = $('input#scan_url').val();

                            if(!/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[/?#]\S*)?$/i.test( _url ))
                            {
                                $('#modalScanResultsBox').html(
                                        _ALERT_TEMPLATE.replaceAll('{T}', 'danger')
                                            .replaceAll('{M}', '{{ trans('pages.scans_create.forms.url_error') }}')
                                            .replaceAll('{H}', 'Oops!')
                                    );

                                $('input#scan_url').focus();

                                _status = false;

                            }else{

                                $(document).ajaxStart(function() {
                                    $('#modalScanUrlInfo').html('<div class="loadingBox"><img src="{{ asset('assets/images/loading.svg') }}"></div>');
                                });

                                $.ajax({
                                    url     : '{{ route('api.scans.add_url') }}',
                                    data    : { _url : _url, _token    : $('meta[name=csrf-token]').attr('content') },
                                    method  : 'POST',
                                    success : function(response){

                                        if(response && response.status == true && response.results && response.results.url){

                                            _CURRENT_DATA = response.results;

                                            $('#modalScanUrlInfo').html(
                                                    _URL_INFO_TEMPLATE.replaceAll('{C}', response.results['content-token'])
                                                        .replaceAll('{F}', response.results['file-token'])
                                                        .replaceAll('{U}', response.results['url'])
                                                );
                                        }else{

                                            $('#modalScanUrlInfo').html('');

                                            $('#modalScanResultsBox').html(
                                                _ALERT_TEMPLATE.replaceAll('{T}', 'danger')
                                                    .replaceAll('{M}', '{{ trans('pages.scans_create.forms.verification_error') }}')
                                                    .replaceAll('{H}', 'Oops!')
                                            );

                                            $('button.js-btn-step[data-orientation=next]').prop('disabled', true);

                                        }
                                    },
                                    error   : function(response){

                                        if(response && response.responseJSON && response.responseJSON.status == false){

                                            $('#modalScanResultsBox').html(
                                                _ALERT_TEMPLATE.replaceAll('{T}', 'danger')
                                                        .replaceAll('{M}', '{{ trans('pages.scans_create.forms.system_error') }}')
                                                        .replaceAll('{H}', 'Oops!')
                                            );

                                            $('button.js-btn-step[data-orientation=next]').prop('disabled', true);
                                        }
                                    }
                                });
                            }
                        }

                        return _status;
                    }
                }
            }).on('shown.bs.modal', function () {
                $('input#scan_url').focus();
            })
            .on('show.bs.modal', function () {

                if($('ul#modalURLListsBox li.list-group-item').length >= _LIST_LIMIT){

                    swal({
                        title: "Oops!",
                        text: "{{ trans('pages.scans_create.forms.limit_error') }}",
                        type: "error",
                        showCancelButton: false,
                        confirmButtonColor: "#F44336"
                    });

                    return false;
                }
            })
            .on('hidden.bs.modal', function () {
                _CURRENT_DATA = null;
            });

            $(document).on('click', '#modalScanUrlInfo .card .media', function() {
                $('.media-body', this).selectText();
            });

            $(document).on('click', '.sweet-alert .card .media', function() {
                $('.media-body', this).selectText();
            });
        });
    </script>
@endsection
