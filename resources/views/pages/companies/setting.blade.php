@extends('layouts.master')

@section('title')
    {{ trans('pages.companies_setting.title') }}
@endsection

@section('container')
	<h2 class="page-title col-lg-8">{{ trans('pages.companies_setting.title') }} <small>{{ trans('pages.companies_setting.description') }}</small>
	</h2>

	<div class="row">
		<div class="col-lg-8">

			@include('errors.validation')

			<section class="widget">
		        <div class="body">
		        	<form action="{{ route('pages.companies.setting') }}" id="company-form" class="form-horizontal form-label-left"
                              novalidate="novalidate"
                              method="post"
                              autocomplete="off" 
                              >
                        <input type="hidden" name="_token" value="{{ csrf_token() }}"></input>
			        	<fieldset>
	                        <legend class="section">{{ trans('pages.companies_setting.limit_settings') }}</legend>
	                        <div class="form-group">
	                            <label class="control-label col-sm-4" for="geo_radius_limit">{{ trans('pages.companies_setting.forms.geo_radius_limit') }} <small>(mil)</small></label>
	                            <div class="col-sm-4">
	                            	<input type="number" id="geo_radius_limit" name="geo_radius_limit" class="form-control" min="0" max="100" value="{{ isset($company->setting->geo_radius_limit) ? $company->setting->geo_radius_limit : 5 }}">
	                            	<span class="help-block">{{ trans('pages.companies_setting.forms.geo_radius_limit_description') }}</span>
	                            </div>
	                        </div>
	                        
	                        <div class="form-group">
	                            <label class="control-label col-sm-4" for="geo_far_driver_limit">{{ 	trans('pages.companies_setting.forms.geo_far_driver_limit') }} <small>(count)</small>
	                            </label>
	                            <div class="col-sm-4">
	                            	<input type="number" id="geo_far_driver_limit" name="geo_far_driver_limit" class="form-control" min="0" max="20" value="{{ isset($company->setting->geo_far_driver_limit) ? $company->setting->geo_far_driver_limit : 2 }}">
	                            	<span class="help-block">{{ trans('pages.companies_setting.forms.geo_far_driver_limit_description') }}</span>
	                            </div>
	                        </div>

	                        <div class="form-group">
	                            <label class="control-label col-sm-4" for="geo_near_driver_limit">{{ trans('pages.companies_setting.forms.geo_near_driver_limit') }} <small>(count)</small>
	                            </label>
	                            <div class="col-sm-4">
	                            	<input type="number" id="geo_near_driver_limit" name="geo_near_driver_limit" class="form-control" min="0" max="20" value="{{ isset($company->setting->geo_near_driver_limit) ? $company->setting->geo_near_driver_limit : 2 }}">
	                            	<span class="help-block">{{ trans('pages.companies_setting.forms.geo_near_driver_limit_description') }}</span>
	                            </div>
	                        </div>

	                    </fieldset>

	                    <fieldset>
	                        <legend class="section">{{ trans('pages.companies_setting.geo_limit_settings') }}</legend>
	                        <div class="form-group">
	                            <label class="control-label col-sm-4" for="allowed_geo_lists">{{ trans('pages.companies_setting.forms.allowed_geo_lists') }}
	                            </label>
	                            <div class="col-sm-8">

	                            	<div class="input-group">
								    	<button id="dynamic_add_btn" class="btn btn-primary" type="button"><span class="fa fa-plus"></span></button>
								    </div>

								    @if(old('geo_lists') && count(old('geo_lists')))
								    	@foreach($company->setting->geo_lists as $index => $list)
		                        			<div class="input-group" style="margin-top:10px;width: 100px;float:left;margin-right:5px;">
										    	<input class="form-control" autocomplete="off" name="geo_lists[{{ $index }}]" type="text" value="{{ $list }}">
										    	<span class="input-group-btn">
										        	<button class="btn btn-danger dynamic_del_btn" type="button"><span class="fa fa-times"></span></button>
										      	</span>
										    </div>
		                        		@endforeach
								    @elseif(isset($company->setting->geo_lists) && count($company->setting->geo_lists))
		                        		@foreach($company->setting->geo_lists as $index => $list)
		                        			<div class="input-group" style="margin-top:10px;width: 100px;float:left;margin-right:5px;">
										    	<input class="form-control" autocomplete="off" name="geo_lists[{{ $index }}]" type="text" value="{{ $list }}">
										    	<span class="input-group-btn">
										        	<button class="btn btn-danger dynamic_del_btn" type="button"><span class="fa fa-times"></span></button>
										      	</span>
										    </div>
		                        		@endforeach
		                        	@endif
	                            </div>
	                        </div>
	                    </fieldset>
	                    <button class="btn btn-primary col-sm-offset-3" type="submit">{{ trans('pages.companies_setting.forms.save_setting') }}</button>
	                </form>
		        </div>
		    </section>
		</div>
	</div>
@endsection

@section('scripts')
	<script type="text/javascript">

		var _TMP_LISTS = '<div class="input-group"><input class="form-control" autocomplete="off" name="geo_lists[{INDEX}]" type="text" value=""><span class="input-group-btn"><button class="btn btn-danger dynamic_del_btn" type="button"><span class="fa fa-times"></span></button></span></div>';

		$('#dynamic_add_btn').on('click', function(e){
			e.preventDefault();

			var _count = Number($(this).parents('.input-group').parent().find('.input-group').length);

			$(this).parents('.input-group').after(
				_TMP_LISTS.replaceAll('{INDEX}', _count)
			).next().css('margin-top', '10px').css('width', '100px').css('float','left').css('margin-right', '5px');
		});

		$(document).on('click', '.dynamic_del_btn', function(e){
			e.preventDefault();
			$(this).parents('.input-group').remove();
		});
	</script>
@endsection