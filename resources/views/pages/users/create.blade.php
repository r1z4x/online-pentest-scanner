@extends('layouts.master')

@section('title')
    {{ trans('pages.users_create.title') }}
@endsection

@section('container')
	<h2 class="page-title">{{ trans('pages.users_create.title') }} <small>{{ trans('pages.users_create.description') }}</small></h2>

	<div class="row">
		<div class="col-lg-8">

			@include('errors.validation')

			<section class="widget">
		        <div class="body">
		        	{!! form($form) !!}
		        </div>
		    </section>
		</div>
	</div>
@endsection

@section('scripts')
	<script>
		$(function(){

	        $('select#company_id, select#branch_id, select#access, select#language').selectpicker();

	        $('select#access').on('change', function(event){
	        	event.preventDefault();

	        	if($('option:selected', this).text() == 'Company User'){
	        		$('select#branch_id').parents('.form-group').slideDown(200);

	        		$('select#company_id option:first-child').trigger('change');
	        	}
	        	else{
	        		$('select#branch_id').parents('.form-group').slideUp(200);
	        		$('select#branch_id').html('');
	        		$('select#branch_id').selectpicker('refresh');
	        	}
	        });

			$('select#company_id').on('change', function(event){
				event.preventDefault();

				var _company_id = $('option:selected', this).val();
				if(_company_id > 0 && $('select#access option:selected').text() == 'Company User'){

					_params = {
						type 		: 'company_id',
						query		: _company_id
					};

					$.ajax({
						url		: '{{ route('api.branches.search') }}',
						data 	: _params,
						method 	: 'GET',
						success	: function(response){
							if(response && response && response.results && response.results.length > 0){ 

								$('select#branch_id').html('');
								
								$.each(response.results, function(k, v){
									$('select#branch_id').append('<option value="'+ v.id +'">'+ v.name +'</option>')
								});

								$('select#branch_id').selectpicker('refresh');
							}
						},
						error 	: function(response){
							if(response && response.responseJSON && response.responseJSON.message){

								Messenger().post({
								    message: response.responseJSON.message,
								    type: 'danger',
								    showCloseButton: true
								});

							}
						}
					});

				}
			});

			$('select#access option:first-child').trigger('change');
		});
	</script>
@endsection